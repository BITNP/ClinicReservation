@page
@using ClinicReservation.Helpers
@model ClinicReservation.Pages.CreateModel
@inject LocalizationCore.CodeMatching.ICodeMatchingService codeMatchingService
@{
    ViewData["Title"] = "填写预约";
    ViewData["DisableLeftNavi"] = true;

    DateTime currentDate = DateTimeHelper.GetBeijingTime();
    DateTime longestDate = currentDate + TimeSpan.FromDays(14);
    string[] datenames = DateTimeHelper.GetDisplayDateTime(currentDate, 5, codeMatchingService);
    int datediff = 0;
    string bookdate = currentDate.ToString("yyyy/MM/dd");
}
@section styles {
    <environment names="Development">
        <link href="~/css/create.css" rel="stylesheet" />
    </environment>
    <environment names="Staging,Production">
        <link href="~/css/create.min.css" rel="stylesheet" asp-append-version="true" />
    </environment>
}
@section scripts {
    <environment names="Development">
        <script src="~/js/create.js"></script>
    </environment>
    <environment names="Staging,Production">
        <script src="~/js/create.min.js" asp-append-version="true"></script>
    </environment>
}
<script>
    window.message = {
        detail: {
            hint: "在此处描述遇到的问题。",
            error: "问题描述需大于5个字符。"
        },
        captcha: {
            error: "验证码只能包含数字。"
        },
        captcha_empty: {
            error: "验证码不能为空。"
        }
    };
</script>
<div>
    <p class="smalltitle">我们的建议</p>
    <div>
        @*@Html.Raw(notificationProvider[culture.Culture])*@
    </div>
    <br />

    <p class="smalltitle">问题描述</p>
    <div>
        <p class="itemname">问题类型</p>
        <div id="input_questiontype" data-control="listbox" data-selected-index="0">
            @foreach (Category cate in Model.Categories)
            {
                <span>@cate.DisplayName</span>
            }
        </div>
        <p class="itemname">详细信息（大于五个字）</p>
        <div id="input_detail" class="input-item" data-control="input" data-type="textarea" style="resize: none; height: 8em"></div>
    </div>

    <p class="smalltitle">预约信息</p>
    <div>
        <p class="itemname">预约地点</p>
        <div id="input_location" data-control="listbox" data-selected-index="0">
            @foreach (Location loc in Model.Locations)
            {
                <span>@loc.DisplayName</span>
            }
        </div>
        <p class="itemname">预约时间</p>
        <div class="date-quick-pick">
            @if (datediff == 0)
            {
                <p class="selected unselectable"><span>@datenames[0]</span></p>
            }
            else
            {
                <p class="unselectable"><span>@datenames[0]</span></p>
            }

            @for (int i = 1; i < datenames.Length; i++)
            {
                @if (datediff == i)
                {
                    @Html.Raw("<p class='selected unselectable'><span>" + datenames[i] + "</span></p>");
                }
                else
                {
                    @Html.Raw("<p class='unselectable'><span>" + datenames[i] + "</span></p>");
                }
            }
        </div>
        <div id="input_bookdate" data-control="datepicker" data-value="@bookdate" data-mindate="@currentDate.ToString("yyyy/MM/dd")" data-maxdate="@longestDate.ToString("yyyy/MM/dd")"></div>
    </div>
    <p class='itemname'>验证码</p>
    <dnt-captcha asp-captcha-generator-max="9876"
                 asp-captcha-generator-min="1234"
                 asp-captcha-generator-language="English"
                 asp-font-name="Tahoma"
                 asp-font-size="18"
                 asp-fore-color="#333333"
                 asp-back-color="#ccc"
                 asp-text-box-template="<div id='input_captcha' class='input-item' data-control='input' data-type='number' data-placeholder='输入图片代表的数字'></div>"
                 asp-refresh-button-class="no-display" />
    <div id="btn_submit" style="margin: 1em 0.3em;" data-control="button" data-text="提交申请"></div>
    <div id="load_ring" data-control="loading" style="top:1.1em; position:relative; opacity: 0"></div>

    @*<textarea id="hidden_problemdetail" style="display: none">@problemdetail</textarea>*@
    <form id="hidden_submiter" asp-page="Create" method="post" enctype="multipart/form-data" style="display:none">
        <input name="category" />
        <textarea name="detail"></textarea>
        <input name="location" />
        <input name="bookdate" />
        <input name="captchaText" />
        <input name="captchaToken" />
        <input name="captchaInput" />
    </form>
    <br />
</div>

